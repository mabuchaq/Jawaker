<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Complex Partner Monte Carlo Bot</title>
<style>
  body { font-family: Arial; padding: 10px; max-width: 600px; margin: auto; }
  textarea { width: 100%; height: 100px; font-family: monospace; }
  button { margin-top: 10px; padding: 8px 12px; font-size:16px; cursor: pointer; }
  #handSelector div { margin-bottom: 8px; }
</style>
</head>
<body>

<h2>Complex Partner Monte Carlo Bot</h2>

<label>Your hand (13 cards, space-separated):</label>
<textarea id="yourHand" placeholder="e.g. A♠ K♠ Q♠ ..."></textarea>

<label>Played cards so far (space-separated):</label>
<textarea id="playedHistory" placeholder="e.g. 10♠ 2♥ ..."></textarea>

<button id="suggestBtn">Suggest Move</button>

<div id="suggestion"></div>

<script>
// === PARAMETERS ===
const ranks = ['A','K','Q','J','10','9','8','7','6','5','4','3','2'];
const suits = ['♠','♥','♦','♣'];
const allCards = ranks.flatMap(r => suits.map(s => r + s));

// === Input Parsing ===
function parseList(txt) {
  return txt.trim().split(/\s+/).filter(c => allCards.includes(c));
}

// === Monte Carlo Sim ===
function suggestMove(yourHand, playedCards, simulations=500) {
  const unseen = allCards.filter(c => !playedCards.includes(c) && !yourHand.includes(c));
  const results = {}; yourHand.forEach(c => results[c] = 0);

  for (let i = 0; i < simulations; i++) {
    const world = shuffle(unseen.slice());
    // assign world: partner, left, right (13 each minus played placeholders)
    const deals = { you: yourHand.slice(), partner: [], left: [], right: [] };
    const slots = ['partner','left','right'];
    world.forEach((c, idx) => {
      const player = slots[Math.floor(idx / 13)];
      deals[player].push(c);
    });

    yourHand.forEach(card => {
      const simScore = playSimulation(card, deals);
      results[card] += simScore;
    });
  }

  // average results and pick highest
  const avg = {};
  yourHand.forEach(card => avg[card] = results[card] / simulations);
  const best = yourHand.reduce((a, b) => avg[a] > avg[b] ? a : b);
  return { best, avg };
}

// === Simulation of full-hand play (very simplified) ===
function playSimulation(startCard, deals) {
  // In this minimal version we return a score: 1 if you/partner have startCard as highest in suit
  const suit = startCard.slice(-1);
  const us = [startCard].concat(deals.partner);
  const others = deals.left.concat(deals.right);
  const usRank = Math.max(...us.map(c => ranks.indexOf(c.slice(0,-1))));
  const bestOther = Math.max(...others.filter(c => c.slice(-1) === suit)
    .map(c => ranks.indexOf(c.slice(0,-1))));
  return usRank > bestOther ? 1 : 0;
}

// === Utility shuffle ===
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// === Button Click ===
document.getElementById('suggestBtn').onclick = () => {
  const yourHand = parseList(document.getElementById('yourHand').value);
  const playedHistory = parseList(document.getElementById('playedHistory').value);
  if (yourHand.length !== 13) {
    alert('Please enter exactly 13 cards in your hand.');
    return;
  }
  const { best, avg } = suggestMove(yourHand, playedHistory, 800);
  let html = `<h3>Best Move: ${best}</h3><ul>`;
  Object.entries(avg).forEach(([c, v]) => {
    html += `<li>${c}: ${v.toFixed(3)}</li>`;
  });
  html += '</ul>';
  document.getElementById('suggestion').innerHTML = html;
};
</script>

</body>
</html>
